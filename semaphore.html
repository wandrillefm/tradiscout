<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Code Sémaphore – Tradiscout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="FINAL.png">
  <link href="https://fonts.googleapis.com/css2?family=Sanchez&family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #e2e5b3;
      color: #0a1d37;
      font-family: 'Sanchez', serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 30px 15px;
      text-align: center;
    }
    h1 {
      font-family: 'Uncial Antiqua', cursive;
      margin-bottom: 10px;
    }
    a.back-link {
      margin-top: 20px;
      color: #0a1d37;
      text-decoration: underline;
    }

    .semaphore-wrapper {
      margin-top: 20px;
    }

    .semaphore-area {
      position: relative;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      border: 2px solid #0a1d37;
      margin: 0 auto 10px;
    }

    .flag {
      position: absolute;
      width: 60px;
      height: 60px;
      top: 50%;
      left: 50%;
      transform-origin: 10px 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>Code sémaphore</h1>
  <p>Fais tourner les deux drapeaux pour former une lettre. Les angles se calent sur 0°, 45°, 90°, etc.</p>

  <div class="semaphore-wrapper">
    <div class="semaphore-area" id="semaphore-area">
      <!-- Remplace drapeau.png par ton visuel -->
      <img src="drapeau.png" class="flag" id="flag-left" draggable="false" alt="Drapeau gauche">
      <img src="drapeau.png" class="flag" id="flag-right" draggable="false" alt="Drapeau droit">
    </div>
    <p>Lettre détectée : <span id="semaphore-letter">?</span></p>
  </div>

  <a href="index.html" class="back-link">← Retour à Tradiscout</a>

  <script>
    const area = document.getElementById('semaphore-area');
    const flagLeft = document.getElementById('flag-left');
    const flagRight = document.getElementById('flag-right');
    const letterSpan = document.getElementById('semaphore-letter');

    let draggingFlag = null;

    function angleFromCenter(event) {
      const rect = area.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;
      const dx = event.clientX - cx;
      const dy = event.clientY - cy;
      let deg = Math.atan2(dy, dx) * 180 / Math.PI;
      if (deg < 0) deg += 360;
      return deg;
    }

    function snapAngle(deg) {
      const step = 45;
      return Math.round(deg / step) * step;
    }

    function applyRotation(flag, deg) {
      flag.dataset.angle = deg;
      flag.style.transform = `translate(-50%, -50%) rotate(${deg}deg)`;
    }

    // Exemple de mapping simplifié (à compléter selon ton alphabet sémaphore)
    const semaphoreMap = {
      '45-315': 'A',
      '90-270': 'B',
      '135-225': 'C',
      '180-180': 'D',
      '225-135': 'E',
      '270-90': 'F',
      '315-45': 'G'
      // etc.
    };

    function updateLetter() {
      const a1 = Number(flagLeft.dataset.angle || 0);
      const a2 = Number(flagRight.dataset.angle || 0);
      const key = `${a1}-${a2}`;
      letterSpan.textContent = semaphoreMap[key] || '?';
    }

    [flagLeft, flagRight].forEach(flag => {
      // position de départ
      applyRotation(flag, 45);
      flag.addEventListener('mousedown', (e) => {
        e.preventDefault();
        draggingFlag = flag;
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
      });
    });

    function onMove(e) {
      if (!draggingFlag) return;
      const deg = angleFromCenter(e);
      const snapped = snapAngle(deg);
      applyRotation(draggingFlag, snapped);
    }

    function onUp() {
      if (!draggingFlag) return;
      draggingFlag = null;
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
      updateLetter();
    }
  </script>
</body>
</html>
